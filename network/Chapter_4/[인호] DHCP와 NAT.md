# 4. DHCP와 NAT
<br>
### 1. DHCP (Dynamic Host Configuration Protocol)

- 수동적으로 계속 서브넷 내의 주소를 할당하는 것을 자동화한 것
- 네트워크 관리자가 사용한다.
- 동적으로 서브넷 안에 있는 호스트의 IP주소를 배정해주는 프로토콜
- 클라이언트-서버 프로토콜이다.
- 임시의 IP주소를 준다
- 이전의 썼었던 IP주소를 준다.
- 보통 서브넷 안에 서버를 두고 호스트가 홈 네트원 안에서의 IP 주소를 할당 받을 수 있게 한다.
- 순서 - 캐스팅 방식(유니, 브로드)은 설정이 가능하다.
    1. DHCP discovery
        - 먼저 브로드캐스팅 방식으로 udp를 이용하여 DHCP 발견 메시지를 보낸다
    2. DHCP offer
        - DHCP가 발견 메시지를 받고 다시 브로드캐스팅 방식으로 DHCP 제공 메시지를 보낸다
        - 이 때 여기에 IP 주소, 네트워크 마스크, IP 주소 임대 기간 등이 적혀있다.
    3. DHCP request
        - 호스트가 여러 DHCP 서버로 받은 제공 메시지 중 좋은 것 하나를 골라 DHCP 요청 메시지를 보낸다.
    4. DHCP ACK
        - 확인 응답이다.
- IP 주소 갱신 메커니즘 또한 가지고 있다.



![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/3cadc4b5-a48c-4504-969d-e18c38e78a17/90c2a57b-0f80-422b-b69a-78ccc27b8c2b/Untitled.png)

### 2. NAT(Network Adress Translate)

- 홈 네트워크에서만 의미가 있는 IP 주소를 외부의 네트워크가 알 수 있게 바꿔주는 기능
- 보통 라우터에 이 기능이 있다
- 보통 하나의 서브넷은 네트워크상에서 하나의 IP주소, 하나의 기기처럼 보인다.
- 이 NAT 기능을 하는 라우터의 서브넷 내의 주소도 DHCP로 인해 자동할당 된다.
- NAT 변환 테이블에 출발지포트 목적지포트를 저장하여 해당 기능을 수행한다
    - 예시

  ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/3cadc4b5-a48c-4504-969d-e18c38e78a17/32dc694e-ad1f-4ab1-97c0-13236fc718b4/Untitled.png)

    1. 홈 네트워크 내의 1번 호스트 (ip 주소가 10.0.0.1)가 외부 서버에서 웹 페이지 요청
    2. 출발지 포트번호 3345로 설정 후 전송
    3. NAT기능 수행 라우터에서 5001이라는 포트번호를 할당하고 출발지 포트를 5001로 변경후 전송
    4. 서버에서는 목적지포트를 5001로 설정하고 응답 수행
    5. 라우터가 해당 응답을 받고, 목적지포트를 3345로 설정하여 1번 호스트로 응답을 보낸다.


### ❇️ 보충

- 서브넷 : 네트워크를 이루는 작은 네트워크를 서브넷이라한다.
- HOP ROUTER(Router Hop) : HOP은 뛰어넘다의 뜻으로 해당 라우터를 거친다는 뜻이다
    - 첫 번째 홉 라우터 : 디폴트 게이트웨이라고도 불린다.
- 서브넷 마스크 : IP 주소를 작게 나눈 조각을 뜻한다.
- LAN : 근거리 네트워크  /  WAN : 광역 네트워크